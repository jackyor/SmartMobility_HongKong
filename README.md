# matsim_HongKong

## scenario

## input data preperation
### network: osm
First, download map file of Hong Kong from [OpenStreetMap](https://www.openstreetmap.org/).
Then, follow the intrustion in [pt2matsim](https://github.com/matsim-org/pt2matsim) to create a network. 
If public transport is needed to be included in the model, it also can use to create multimodel network and transit schedule that used for simlulating public transport in MATSim.

### plan: tcs
The MATSim plan file represents a synthesis population generated from the data of the [Travel Characteristics Survey 2011](https://www.td.gov.hk/en/publications_and_press_releases/publications/free_publications/travel_characteristics_survey_2011_final_report/index.html) and [census 2021]([https://www.census2021.gov.hk/en/index.html](https://www.census2021.gov.hk/en/index.html)) .
Since the model did not access to the detailed data of both sources, the synthesis population is generated from general parameter in tcs2011 and census 2021. 
The synthesis population is focused on the daily commuting work trips travelling by taxi only and generated by the following steps. 

1) Get inner and inter commuting data
First, get the [Statistics by District Council Constituency Area](https://www.census2021.gov.hk/doc/DCCA_21C.xlsx) from census 2021. It lists **Working population by place of work** including Work in the same district; Work in another district on Hong Kong Island; Work in another district in Kowloon; Work in another district in new towns; and Work in another district in other areas in the New Territories. These stats are grouped by District Council Constituency Area.

2) Mark buildings to their District Council and District Council Constituency Areas
Get the buildings of hong kong from [Lands Department](https://data.gov.hk/en-data/dataset/hk-landsd-openmap-b50k-topographic-map-of-hong-kong).
Then, use gis to mark buildings to their District Council and District Council Constituency Areas. It is used for the random selection of home and work coordinates in the next step.
To be more precise, you can seperate residential buildings and others for the selection of the coordinates of home and work.

3) Generate inter and inner district commuting work trips
Create a inner.csv and a inter.csv from the communting data, similar to the csv files in the "forplan" folder with the use of [Table A.2 Daily Person Trip Productions and Attractions by Broad District and Trip Purpose](https://www.td.gov.hk/filemanager/en/content_4652/tcs2011app_eng.pdf) by tcs 2011.

Then, set the home end time, work end time. It was set as the same home end time and work end time for every plan. I redistributed them according to the Figure 3.3 Hourly Profiles of Mechanised Trips Travel Characteristics Survey 2011 final report by python script uploaded as **main.py**. 

<img width="682" alt="Figure 3.3 Hourly Profiles of Mechanised Trips in Travel Characteristics Survey 2011 final report" src="https://github.com/jackyor/matsim_HongKong/assets/87265896/22a60ac0-78b1-46a0-98d5-9fed0842a077">

Next, the inter and inner district commuting work trips were generated. As according to Table A.3 Number of Daily Boardings by Transport Mode and Trip Purpose in tcs 2011, for home based work trips, trips travelling by taxi was about 3.72% (230,000/6,179,000) of all home based work trips. Therefore, only 3.72% of home based work trips were generated. The coordinates of home were randomly selected in the pool of buildings marked with the designated District Council Constituency Areas in the inner or inter csv file. The coordinates of work were randomly selected in the pool of buildings marked with the designated 
District Council or the number representing different New Towns. In this model, all plans have the same activity structure as home - work - home.


### drt vehicle
Use **CreateFleetVehicles.java** to create vehicle files with designated number of vehicles and operation hour. Drt vehicles in this model operated in 24 hours.
### drtstop
The virtual stops representing stops for drt vehicles operating in stop-based ridepooling is in the **drtStops.xml **. Stops were extracted from the OpenStreetMap as points of Taxi Stand in Hong Kong.

## Matsim
More details about MATSim in [MASTim.org](https://www.matsim.org/)
The config file are in the scenarios/opt follder as ***.config.xml**. door2s refer to door-to-door based ridepooling with a capacity of 2 and stop2s refer to stop-based ridepooling with a capacity of 2.
DRT, DVRP and drt-extension are the extension used for stimulating ridepooling in this model, those can be found in https://github.com/matsim-org/matsim-libs/tree/master/contribs.

## output
- example file
- simwrapper

## run
- linux config
- how to run
- runtime
